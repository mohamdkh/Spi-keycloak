# Spi-keycloak
Java 6 a introduit une fonctionnalité  pour  le chargement des implémentations correspondant à une interface donnée: Service Provider Interface (SPI).
Dans ce repos, nous présenterons les composants de Java SPI et montrerons comment nous pouvons l'appliquer à un cas d'utilisation pratique.

1-PI de stockage utilisateur : (SPI user storage)

Vous pouvez utiliser le SPI User Storage pour écrire des extensions dans Keycloak afin de vous connecter aux bases de données d'utilisateurs externes et aux bases de données  d'informations d'identification. Le support LDAP et ActiveDirectory intégré est une implémentation de ce SPI en action. Prêt à l'emploi, Keycloak utilise sa base de données locale pour créer, mettre à jour et rechercher des utilisateurs et valider les informations d'identification. Cependant, les organisations disposent souvent de bases de données d'utilisateurs propriétaires externes qu'elles ne peuvent pas migrer vers le modèle de données de Keycloak.  Dans ces situations,on peut  écrire des implémentations de User Storage SPI pour relier la base de données  d'utilisateurs externes et le modèle d'objet utilisateur interne que Keycloak utilise pour connecter les utilisateurs et les gérer.
Lorsque le moteur d'exécution de Keycloak doit rechercher un utilisateur, par exemple lorsqu'un utilisateur se connecte, il effectue un certain nombre d'étapes pour localiser l'utilisateur. Il cherche d'abord à voir si l'utilisateur est dans le cache utilisateur; Ensuite, il recherche l'utilisateur dans la base de données locale Keycloak. Si l'utilisateur n'est pas trouvé, il effectue une boucle sur les implémentations du fournisseur SPI User Storage pour exécuter la requête utilisateur jusqu'à ce que l'un d'eux renvoie l'utilisateur recherché par le runtime. Le fournisseur interroge la base de données  d'utilisateurs externe pour l'utilisateur et mappe la représentation des données externes de l'utilisateur au métamodèle utilisateur de Keycloak.
Les implémentations de fournisseur SPI User Storage peuvent également effectuer des requêtes de critères complexes, effectuer des opérations CRUD sur les utilisateurs, valider et gérer les informations d'identification ou effectuer des mises à jour groupées de nombreux utilisateurs à la fois. Cela dépend des capacités du base de données externe.
Les implémentations de fournisseur SPI User Storage sont conditionnées et déployées de la même manière (et sont souvent) des composants Java EE. Ils ne sont pas activés par défaut, mais doivent être activés et configurés par domaine sous l' User Federationonglet de la console 
